// Copyright 2025 Oliver Eikemeier. All Rights Reserved.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//
// SPDX-License-Identifier: Apache-2.0

package a

import "fmt"

// Test Init field conflicts: when multiple variables target the same Init field,
// all suggestions should be suppressed.

// Two variables used in same if condition - conflict, no suggestion.
func twoVarsIfCondition() {
	a := 1 // want "Variable 'a' can be moved to tighter if scope"
	b := 2 // want "Variable 'b' can be moved to tighter if scope"
	if a == 1 && b == 2 {
		fmt.Println("both used in condition")
	}
}

// Three variables targeting same Init field - conflict, no suggestion.
func threeVarsSwitch() {
	x := 1 // want "Variable 'x' can be moved to tighter switch scope"
	y := 2 // want "Variable 'y' can be moved to tighter switch scope"
	z := 3 // want "Variable 'z' can be moved to tighter switch scope"
	switch {
	case x == 1:
		fmt.Println(y, z)
	case y == 2:
		fmt.Println(x, z)
	default:
		fmt.Println(x, y)
	}
}

// Two variables, but one used outside - only one targets Init, so it can move.
func twoVarsOneEscapes() {
	// want "Variable 'a' can be moved to tighter if scope"
	b := 2
	if a := 1; a == 1 {
		fmt.Println("a is 1")
	}
	fmt.Println(b) // b used outside, can't move
}

// Multiple variables, but different target scopes - no conflict.
func differentTargetScopes() {
	// want "Variable 'a' can be moved to tighter if scope"
	// want "Variable 'b' can be moved to tighter if scope"

	if a := 1; a == 1 {
		fmt.Println("first if")
	}

	if b := 2; b == 2 {
		fmt.Println("second if")
	}
}

// Two variables competing for for loop Init - conflict, no suggestion.
func twoVarsForInit() {
	max := 10 // want "Variable 'max' can be moved to tighter for scope"
	i := 0    // want "Variable 'i' can be moved to tighter for scope"
	for i < max {
		fmt.Println(i)
		i++
	}
}

// Variables in multi-value assignment - share same declInfo, move together.
func multiValueSameTarget() {
	// want "Variables 'x' and 'y' can be moved to tighter if scope"
	if x, y := 1, 2; x == 1 && y == 2 {
		fmt.Println("multi-value assignment")
	}
}

// Switch statement - not both can be moved inside the init.
func switchStatement() {
	a := "a" // want "Variable 'a' can be moved to tighter switch scope"
	b := "b" // want "Variable 'b' can be moved to tighter switch scope"
	switch a {
	case b:
		fmt.Println("switch")
	}
}
